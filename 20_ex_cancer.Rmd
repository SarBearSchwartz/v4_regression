# Ex: Cancer Experiment 


```{r, include=FALSE}
# set global chunk options...  
#  this changes the defaults so you don't have to repeat yourself
knitr::opts_chunk$set(comment     = NA,
                      cache       = TRUE,
                      echo        = TRUE, 
                      warning     = FALSE, 
                      message     = FALSE,
                      out.width   = "75%")
```




```{r, comment=FALSE, message=FALSE}
library(haven)
library(tidyverse)
library(flextable)
library(psych) 
library(apaSupp)
library(olsrr)
library(modelsummary)
library(parameters)
library(effectsize)
library(interactions)
library(performance)
library(ggResidpanel)
library(emmeans)
library(effects)
```

```{r}
emmeans::emm_options(opt.digits = FALSE)  # revert to optimal digits
```


## PURPOSE

### Research Question

> For this example page: Does weight vary with age?


### Data Description

The `Cancer` data set contains 4 repeated measure of oral condition for 25 cancer patients to see if an aloe treatment helps with oral condition (ulcers).


```{r}
cancer_raw <- haven::read_spss("https://raw.githubusercontent.com/CEHS-research/eBook_ANOVA/master/data/Cancer.sav")
```


```{r}
tibble::glimpse(cancer_raw)
```

```{r}
cancer_clean <- cancer_raw %>% 
  dplyr::rename_all(tolower) %>% 
  dplyr::mutate(id = factor(id)) %>% 
  dplyr::mutate(trt = factor(trt,
                             labels = c("Placebo", 
                                        "Aloe Juice"))) %>% 
  dplyr::mutate(stage = factor(stage))

tibble::glimpse(cancer_clean)
```



```{r}
psych::headTail(cancer_clean) %>% 
  flextable::flextable() %>% 
  apaSupp::theme_apa(caption = "Sample of Cancer Dataset")
```




## EXPLORATORY DATA ANALYSIS


```{block type='rmdimportant', echo=TRUE}
Before embarking on any inferencial anlaysis or modeling, always get familiar with your variables one at a time *(univariate)*, as well as pairwise *(bivariate)*.
```



### Univariate Statistics

Center: mean and median
Spread: standard deviation, range (max - min), interquartile range (Q3 - Q1)

```{r}
cancer_clean %>% 
  dplyr::select("Age" = age,
                "Weight" = weighin) %>% 
  apaSupp::tab_desc(caption = "Description of Participants")
```


### Univariate Visualizations


```{r}
cancer_clean %>% 
  apaSupp::spicy_histos(var = age)
```


```{r}
cancer_clean %>% 
  apaSupp::spicy_histos(var = weighin)
```




### Bivariate Statistics

```{r}
cancer_clean %>% 
  cor.test(~ age + weighin,
           data = .)
```



### Bivariate Visualization


```{r}
cancer_clean %>% 
  ggplot(aes(x = age,
             y = weighin)) +
  geom_point() +
  geom_smooth(aes(color = "Linear"), 
              method = "lm", 
              formula = y ~ x,
              se = TRUE) +  
  geom_smooth(aes(color = "Loess"),  
              method = "loess", 
              se = FALSE) +     
  theme_bw() +
  labs(x = "Age, years",
       y = "Weight, pounds",
       color = "Smoother") +
  theme(legend.position = c(1, 1),
        legend.justification = c(1.1, 1.1),
        legend.background = element_rect(color = "black"))
```


## REGRESSION ANALYSIS

* The dependent variable (DV) is weight at intake ($Y$)
* The independent variable (IV) is age at intake ($X$)

### Fit the Model

```{r}
fit_lm <- lm(weighin ~ age,
             data = cancer_clean)
```


### Parameter Estimates

```{r}
summary(fit_lm)
```



### Prediction Equation

```{r}
coef(fit_lm)
```



$$
\hat{weight} = 220.69 - 0.71 \times (age)
$$


### Estimated Marginal Means

```{r}
fit_lm %>% 
  emmeans::emmeans(~ age)
```

```{r}
fit_lm %>% 
  emmeans::emmeans(~ age,
                   at = list(age = c(30, 60, 90))) 
```


```{r}
fit_lm %>% 
  emmeans::emmeans(~ age,
                   at = list(age = seq(from = 30, to = 90, by = 10)))
```


```{r}
fit_lm %>% 
  effects::Effect(focal.predictors = c("age"))
```


```{r}
fit_lm %>% 
  effects::Effect(focal.predictors = c("age"),
                  xlevels = list(age = seq(from = 30, to = 90, by = 1))) %>% 
  data.frame() 
```




```{r, fig.cap = "Weight Regressed on Age"}
fit_lm %>% 
  effects::Effect(focal.predictors = c("age"),
                  xlevels = list(age = seq(from = 30, to = 90, by = 1))) %>% 
  data.frame() %>% 
  ggplot(aes(x = age,
             y = fit)) +
  geom_ribbon(aes(ymin = fit - se,
                  ymax = fit + se),
              alpha = .2) +
  geom_line() +
  theme_bw() +
  labs(x = "Age, years",
       y = "Estimated Marginal Mean\nWeight, pounds")
```



